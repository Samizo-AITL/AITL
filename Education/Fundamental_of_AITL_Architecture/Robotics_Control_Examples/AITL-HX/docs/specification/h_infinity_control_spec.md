# H∞制御仕様書（AITL-HX制御構造におけるロバスト制御モジュール）

本仕様書は、AITL-HXの物理制御層における**多変数H∞制御器**の設計指針および実装仕様を記述します。Samizoアーキテクチャにおける「FSM×LLM」の上層と接続し、ロバストで安定した制御信号を物理系に提供することを目的とします。

---

## 🎯 目的と位置づけ

- **外乱・モデリング誤差・センサノイズ**に対するロバスト制御を実現
- FSMからの状態遷移情報をもとに、動的な目標値と制御ゲインを切替
- 制御対象：多関節アーム／冷却ファン／車輪系ロボットなど

```
FSM ──▶ [H∞ Controller] ──▶ Actuator
           ▲
           │
      状態・目標・センサ入力
```

---

## ⚙️ 制御構造の概要

### 数理モデル（例：状態空間表現）

制御対象は以下の形式で記述：

```
x_dot = A x + B u + E w
z     = C1 x + D1 u + F1 w     ← 性能出力
y     = C2 x + D2 u + F2 w     ← センサ出力
```

- `x`: 状態ベクトル
- `u`: 制御入力（LLM/FSMからの目標追従）
- `w`: 外乱（温度変化、姿勢変化、通信遅延）
- `z`: 性能出力（誤差・応答性などを含む）
- `y`: センサからの出力

---

## 🛠️ H∞制御器設計仕様

### 設計目標

- 指定された性能指標 `‖Tzw‖∞ < γ` を満たす制御器 `K(s)` を設計
- 状態フィードバック型または出力フィードバック型のどちらも対応可能

### 設計手順（概要）

1. `H∞` 最適化問題の定式化
2. MATLAB／Pythonの制御ライブラリで LMI（線形行列不等式）を解く
3. 制御器 `K` を得て、リアルタイム制御へ変換（離散化）

### 使用ツール（例）

- Python: `control`, `slycot`, `scipy`, `cvxpy`
- MATLAB: `hinfsyn`, `robustcontrol`, `hinfstruct`

---

## 🔄 FSM連携

FSM側が状態を切り替えると、以下の情報をH∞制御器に通知：

```json
{
  "state": "fine_control",
  "target_position": [0.4, 0.1, -0.2],
  "disturbance_estimate": [0.03, -0.01, 0.0]
}
```

制御器はこれを受け取り、状態空間モデルのパラメータまたは参照入力 `r(t)` を切り替えて、誤差最小化を行う。

---

## 🚨 フォールト対応

- センサ断／過大外乱時は、FSMにアラートを返し `safe_mode` に移行
- 離散制御の周期と計測更新タイミングの非同期も許容設計とする（例：ZOH＋デッドタイム補償）

---

## 📐 モデル例：冷却ファン制御（簡易モデル）

```python
# 1入力1出力の熱負荷モデル
A = [[-1.2]]        # 熱容量による減衰
B = [[1.0]]         # ファン回転数による冷却力
C1 = [[1.0]]        # 熱出力性能
C2 = [[1.0]]        # センサ出力
```

---

## 🧪 PoC用パラメータ（例）

| 対象         | 状態変数 | 入力 | 外乱 | 制御周期 |
|--------------|-----------|------|------|-----------|
| 冷却ファン    | 温度      | 回転数 | 環境熱流 | 50ms      |
| 関節アーム    | 角度,速度 | トルク | モーメント変動 | 10ms |

---

## 📚 関連資料

- `fsm_engine.py`: 状態遷移と目標切替
- `llm_interface.py`: LLMからの指示反映
- `interaction_scenario.md`: 動作テストにおける異常条件付き評価

---

## 📄 ライセンス

MIT License  
(C) 2025 Shinichi Samizo & AITL Project Team
