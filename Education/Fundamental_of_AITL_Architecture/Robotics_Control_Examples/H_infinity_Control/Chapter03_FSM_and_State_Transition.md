# 第3章：有限状態機械（FSM）と状態遷移制御

---

## 3.1 FSMの基礎概念

### 有限状態機械（FSM: Finite State Machine）とは

- システムの動作を「状態（State）」と「遷移（Transition）」で表現するモデル
- 各状態において入力に応じた出力を行い、他の状態へ遷移する
- 主に2種類の形式がある：
  - **Moore型**：出力は状態のみに依存
  - **Mealy型**：出力は状態と入力に依存

---

## 3.2 状態遷移の設計方法

### 状態遷移表と状態遷移図

- **状態遷移表**：状態と入力の組み合わせによる次状態と出力を表形式で示す
- **状態遷移図**：状態をノード、遷移を矢印で示す視覚的表現

### 遷移条件と出力

- 遷移条件はセンサ入力や内部フラグによって定義される
- 出力信号は状態や遷移ごとに決定される（モータON/OFF、アラート出力など）

---

## 3.3 FSMの制御への応用例

### ロボットにおけるFSM活用例

例：モバイルロボットの移動制御

- **状態例**：
  - `IDLE`：待機
  - `FORWARD`：前進
  - `AVOID`：障害物回避
  - `ERROR`：異常停止

- **入力例**：
  - `GO`信号、センサ距離、エラー検出フラグ

- **出力例**：
  - モータ制御信号（PWM）、LED表示、音声出力など

---

## 3.4 FSMの実装

### ソフトウェア実装（例：C言語）

```c
switch(state) {
  case IDLE:
    if (go_signal) state = FORWARD;
    break;
  case FORWARD:
    if (obstacle_detected) state = AVOID;
    break;
  case AVOID:
    if (path_clear) state = FORWARD;
    break;
  case ERROR:
    // stay or reset
    break;
}
```

### ハードウェア実装（例：RTL）

- 状態レジスタ + コンビネーショナル回路で構成
- FPGAやASIC設計ではVerilog/VHDLで記述

---

## 3.5 FSMの課題と拡張

### 状態爆発問題

- 状態数が増えると、設計・検証が非常に困難になる
- 特に多モード・異常系を含むシステムでは深刻

### 解決策

- **階層的FSM（Hierarchical FSM）**：サブFSMを組み合わせて構造化  
- **状態遷移の推論化**：LLMなどで遷移ルールを支援生成

---

## 3.6 まとめ

- FSMは制御ロジック設計の基本構造であり、状態管理に有効
- ロボット制御においても行動の切替や異常時の動作に広く用いられる
- AITLではFSMが推論層・制御層をつなぐ「行動スイッチ」として中心的に使われる

---
