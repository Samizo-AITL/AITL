# 🛡️ LLMフェイルオーバー設計（LLM Failover Policy）

本ドキュメントでは、LLMが応答しない／異常応答する場合のFSM側の自律バックアップ制御方針を定める。

---

## ☁️ 想定される異常ケース

| ケース                     | 内容                                         |
|----------------------------|----------------------------------------------|
| LLM APIタイムアウト        | 通信不良・クラウド側停止                     |
| LLM応答形式エラー          | JSON構造破損・空文字列など                   |
| 危険ワード・非倫理的応答   | 不適切語句、脱線した応答文                   |
| 無効な状態提案             | FSM未定義の状態を提案                        |

---

## 🔁 フェイルオーバー処理フロー

```text
       ↓ LLM呼出失敗
+-----------------------------+
| FSMが提案代替状態にフォールバック |
+-----------------------------+
       ↓
+-----------------------------+
| 状態: SAFE_MODE or TALK_MODE |
+-----------------------------+
       ↓
+-----------------------------+
| 応答: 固定文をTTS出力        |
+-----------------------------+
```

---

## 🧩 FSM側バックアップ動作

| 状態         | デフォルト遷移先       | 応答テンプレート（例）                         |
|--------------|------------------------|------------------------------------------------|
| `CARE_MODE`  | `TALK_MODE`            | 「お話しましょうか」                           |
| `ALERT_MODE` | `SAFE_MODE`            | 「落ち着いてください。今は安全な状態です」     |
| その他       | `IDLE`                 | 「すみません、少し待ってください」             |

---

## 🔒 安全設計ポリシー

- FSMは**LLMの出力に依存せずに最小限の制御を維持**する
- LLM応答が不明・不適切な場合は **セーフティ優先**
- LLMは**推奨補助役**であり、主制御はFSMが保持

---

この設計により、LLMを活用しつつも**安全性・可用性・透明性**を確保するPoCが実現される。
