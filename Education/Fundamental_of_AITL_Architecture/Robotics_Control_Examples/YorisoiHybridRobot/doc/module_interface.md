# 🔧 モジュール間インタフェース仕様書

本ドキュメントでは、主要なソフトウェアモジュールの関数構成・入出力フォーマット・連携インタフェースを明記する。

---

## 🧩 全体構成図（機能ブロック）

```text
         emotion_input.json
                 ↓
       +------------------+
       |  SensorManager   |
       +------------------+
                 ↓
       +------------------+
       |   FSM Engine     | ← fsm_state_def.yaml
       +------------------+
                 ↓
         [current_state]
                 ↓
       +------------------+
       |  LLM Interface    |
       +------------------+
                 ↓
       +------------------+
       | Action Executor   |
       +------------------+
                 ↓
      TTS / 表情 / モータ制御など出力
```

---

## 📘 各モジュール詳細

### 1. `SensorManager`

| 関数               | 引数              | 戻り値                      | 説明                    |
|--------------------|-------------------|------------------------------|-------------------------|
| `load_emotion_input()` | JSONファイルパス     | Dict形式の感情・入力情報     | センサ入力の読み取り    |

---

### 2. `fsm_engine.py`

| 関数              | 引数                      | 戻り値                | 説明                       |
|-------------------|---------------------------|------------------------|----------------------------|
| `load_state_def()`| YAMLパス                  | 状態定義Dict           | 状態定義の読み込み         |
| `evaluate_transition(input_data)` | 入力JSON                 | `new_state`            | 状態遷移の実行             |

---

### 3. `llm_interface.py`

| 関数                   | 引数                    | 戻り値                             | 説明                        |
|------------------------|-------------------------|------------------------------------|-----------------------------|
| `generate_response(input_data)` | 感情・発話・表情のDict  | `llm_response.json`形式のDict     | 応答と状態提案を生成         |

---

### 4. `action_executor.py`

| 関数                | 引数                      | 戻り値         | 説明                               |
|---------------------|---------------------------|----------------|------------------------------------|
| `execute_action(response_data)` | LLM応答（state＋text） | None           | 音声・表情・モーション出力         |

---

## 🔄 モジュール連携形式

- すべての入出力は **Dict構造のJSON互換** で統一
- 実装言語：Python 3.11（予定）
- テスト：単体 + 統合（ログ再現・再生可能）

---

この設計により、モジュールの**再利用性・保守性・テスト性**を最大化しながら、FSMとLLMが緊密に連携した構造を実現する。
