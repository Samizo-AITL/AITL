# 🧭 YorisoiHybridRobot アーキテクチャ構成図（FSM × LLM ハイブリッド）

---

## 🧩 全体構成（三層構造）

```text
+----------------------------+
|        推論層（理性）       | ← LLM (Python/LLM API)
| - 状態提案・感情理解       |
| - 応答生成（自然言語）     |
+----------------------------+
            ▲
            │ JSON API
            ▼
+----------------------------+
|        制御層（意思）       | ← FSM (Python/C)
| - FSM状態遷移制御          |
| - 状態遷移履歴管理         |
| - セーフティ制御判断       |
+----------------------------+
            ▲
            │ センサ値・命令
            ▼
+----------------------------+
|        物理層（身体）       | ← Verilog / PWM制御
| - センサ信号取得            |
| - PWM生成・音声出力         |
| - アクチュエータ駆動        |
+----------------------------+
```
## 📦 モジュール接続概要

各層の主要モジュールと、それに対応するファイルを以下に整理する。

| 層        | 主モジュール            | ファイル名                                      | 概要説明                                       |
|-----------|-------------------------|--------------------------------------------------|------------------------------------------------|
| 推論層    | `LLMInterface`          | `code/llm_interface.py`                         | 感情・音声・表情入力に基づき、状態提案と発話文を生成する |
| 制御層    | `FSMEngine`             | `code/fsm_engine.py`                            | 状態定義と状態遷移ルールに基づいて遷移処理を行う         |
| 制御層    | `MainController`        | `code/main_controller.py`                       | 各層を統合し、入力・状態管理・出力までを1ループで制御     |
| 物理層    | `ActionExecutor`        | `code/action_executor.py`                       | LLMやFSMの命令に応じてTTSやモーター駆動などの出力処理を行う |
| 物理層    | `SensorManager`         | `code/sensor_manager.py`（仮）                  | JSONファイルに保存されたセンサ情報を読み込み整形する       |

---

## 🔧 補足モジュール（共通・設定）

| モジュール        | ファイル名                   | 概要                           |
|-------------------|-------------------------------|--------------------------------|
| 状態定義ファイル  | `code/fsm_state_def.yaml`     | FSMの全状態と遷移条件をYAMLで定義する |
| テストデータ       | `data/*.json`                 | シナリオ再生用の入力データ群       |
| ログファイル       | `data/interaction_log.jsonl`  | 実行ログの蓄積（1行1ステップ）     |

---

これらのモジュールとファイルは、三層モデルに対応しつつも、**疎結合な構成**により独立開発・修正・評価が可能となっている。
