# ✅ テスト計画・評価方針

本ドキュメントは、YorisoiHybridRobotのPoCにおける各機能のテスト方針・評価基準を示す。

---

## 🔬 テスト構成

### 1. 単体テスト（Unit Test）

| 対象モジュール        | テスト項目                                | 期待結果                           |
|------------------------|--------------------------------------------|------------------------------------|
| `fsm_engine.py`        | 状態定義通りの遷移が行われるか             | 入力条件に応じ正確な遷移           |
| `llm_interface.py`     | 指定形式の出力がJSONで返るか               | `suggested_state` と `response_text` |
| `action_executor.py`   | 指定動作が出力形式に従って生成されるか     | 出力トーン・表情・動作が正しい     |

---

### 2. 統合テスト（Integration Test）

| テストケース                   | シナリオ説明                                | 成否基準                                |
|--------------------------------|----------------------------------------------|-----------------------------------------|
| 感情 → 応答 → アクション       | `sad` 入力 → `CARE_MODE` → やさしい応答      | LLM/FSM/出力連携が正しく行われること   |
| 疲労感 → 休息誘導              | `tired` → `REST_MODE` → ゆっくり声            | 出力タイミングとトーンが適切なこと     |
| 異常入力 → セーフティ遷移     | `confused` → `ALERT_MODE` → 通知動作         | 強制停止と警告出力が行われること       |

---

### 3. ログ検証（Log-based Test）

- `interaction_log.jsonl` をリプレイして状態推移が再現されるか
- FSM/LLMの出力整合性が履歴上から確認可能か

---

## 🧪 評価観点

| 項目             | 測定指標                                 |
|------------------|------------------------------------------|
| 応答の自然さ     | ユーザー満足度（アンケート・主観評価）   |
| 状態遷移の妥当性 | FSMルールとLLM提案との整合性             |
| 再現性・透明性   | JSONLログによる完全再現可能性            |
| ロバスト性       | 感情バリエーション・異常時の動作安定性   |

---

## 🛠️ 使用ツール

- Python ユニットテスト：`pytest`
- シナリオ再生・比較：`jsondiff`, `diff-json`
- ログ評価可視化：`pandas`, `matplotlib`

---

このテスト方針により、実装機能の正当性・一貫性・実用性を客観的に評価可能とする。
