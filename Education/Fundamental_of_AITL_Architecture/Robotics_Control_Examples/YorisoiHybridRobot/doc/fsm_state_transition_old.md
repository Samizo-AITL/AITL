# 🔄 FSM × LLM 状態遷移構成図（寄り添い型ロボット）

---

## 🧠 状態定義

| 状態名         | 説明                                       |
|----------------|--------------------------------------------|
| IDLE           | 初期状態。ユーザー入力待ち                 |
| CARE_MODE      | 感情への寄り添い状態（共感・励まし）       |
| TALK_MODE      | 対話継続状態。雑談・会話のキャッチボール   |
| REST_MODE      | 休憩・リラックス誘導モード                 |
| SLEEP_MODE     | 無応答・長時間待機状態                      |

---

## 🔁 状態遷移パターン（FSM主導＋LLM補完）

```text
           ┌──────────────┐
           │    IDLE      │
           └────┬─────────┘
                │  sad/emotion detected
                ▼
           ┌──────────────┐
           │  CARE_MODE   │◄────────────┐
           └────┬─────────┘             │
                │ talk requested        │
                ▼                       │ grateful / end of rest
           ┌──────────────┐             │
           │  TALK_MODE   │             │
           └────┬─────────┘             │
                │ tired / fatigue       │
                ▼                       │
           ┌──────────────┐             │
           │  REST_MODE   │─────────────┘
           └────┬─────────┘
                │ no input for long
                ▼
           ┌──────────────┐
           │ SLEEP_MODE   │
           └──────────────┘
```

## 🤖 LLM提案の介入ポイント

LLMは、FSMの形式的な状態遷移だけでは対応しきれない「感情」「文脈」「言外の意味」を補完する役割を担う。

以下は代表的な介入ポイント：

---

### 1. 感情入力による寄り添い提案

| 入力内容             | LLM提案                 | 理由                                       |
|----------------------|--------------------------|--------------------------------------------|
| emotion = "sad"      | suggested_state = CARE_MODE | 「寂しい」という感情に寄り添う              |
| voice_text = "今日は寂しい" | CARE_MODE                | テキストの意味内容から共感応答を導出       |

---

### 2. 対話要求に応じた会話モード提案

| 入力内容                 | LLM提案               | 理由                                         |
|--------------------------|------------------------|----------------------------------------------|
| voice_text = "話してほしい" | suggested_state = TALK_MODE | 会話の継続・開始意志の表明を検出           |
| emotion = "neutral"       | TALK_MODE               | 感情が安定しており、対話可能と判断          |

---

### 3. 疲労の申告に対する休息誘導

| 入力内容                 | LLM提案               | 理由                                           |
|--------------------------|------------------------|------------------------------------------------|
| voice_text = "疲れた"     | REST_MODE              | ユーザーの疲労感に対応し、休息モードへ誘導    |
| emotion = "tired"         | REST_MODE              | 身体的・精神的疲労の推定により適切に誘導     |

---

### 4. 感謝表現によるリセット・回帰提案

| 入力内容                 | LLM提案               | 理由                                        |
|--------------------------|------------------------|---------------------------------------------|
| voice_text = "ありがとう" | CARE_MODE              | 寄り添いの再提示や、余韻を保つような応答    |
| emotion = "grateful"     | CARE_MODE              | 相手に好意を持っていることが表現されている |

---

### 5. 状態が変わらない場合の自然応答提案

| 状況                         | LLM提案の動き           | 内容                             |
|------------------------------|--------------------------|----------------------------------|
| fsm_state 維持                | action のみを返す        | 「うなずく」「それはよかったですね」など |
| 無入力 or 短文リプライ時     | context-aware response   | 状態は保ったまま対話を継続       |

---

このように、LLMはFSMの「形式的な状態制御」に対し、
人間らしいニュアンスや個別対応を加えるための柔軟な補助機構として機能する。
