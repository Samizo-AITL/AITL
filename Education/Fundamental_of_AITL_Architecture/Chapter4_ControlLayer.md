# Chapter 4: Control Layer – Model-Based Control Design  
## 制御層：Simulink / Stateflowによる状態遷移と制御則設計

---

## 4.1 制御層の役割

AITLの制御層は、論理層からの命令や仕様を受け取り、実際の動作を具体的に生成する役割を担います。  
具体的には以下の処理を行います：

- 状態機械（State Machine）によるシステム状態の管理  
- PID制御、MPC（Model Predictive Control）などの制御則設計  
- フィードバック制御による外乱補償や目標追従

---

## 4.2 モデルベース設計の重要性

制御層設計はモデルベース開発（MBD）を基本とします。SimulinkやStateflowは以下の利点を持ちます：

- ビジュアルかつ階層的な状態遷移設計が可能  
- 制御理論の数学モデルを直接シミュレーションできる  
- HDL Coderを利用してFPGA/ASIC向けコードを自動生成可能

---

## 4.3 状態遷移と制御則の設計例

例として、移動ロボットの回避行動を制御するモデルを考えます。

- **状態遷移**：通常移動 → 障害物検知 → 回避動作 → 通常移動  
- **制御則**：回避動作中は速度制限、回避軌道追従のPID制御  

SimulinkとStateflowでこれらを統合的に設計し、シミュレーションで動作を確認します。

---

## 4.4 検証プロセス

- MiL（Model in the Loop）: 制御モデルのロジック検証  
- SiL（Software in the Loop）: 生成コードのソフトウェア検証  
- HiL（Hardware in the Loop）: 実FPGAやハードウェア環境での動作検証  

これらの段階を経て、設計の信頼性を確保します。

---

## 4.5 教育的活用

- 学生はモデルベース設計の実践を通じて制御理論を体感  
- 仕様から具体的制御則への展開を理解  
- 実FPGAとの連携によるハード・ソフト協調設計を体験

---

## 次章予告

次章では、物理層（Physical Layer）について説明します。  
センサ・アクチュエータの特性やノイズ、遅延など、実世界の物理的制約を考慮した設計を学びます。

---
